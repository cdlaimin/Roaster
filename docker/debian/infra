# syntax=docker/dockerfile:1

FROM docker.codingcafe.org/xkszltl/roaster/ubuntu:stage-intel

ARG LABEL_BUILD_ID=Undefined
LABEL BUILD_ID=$LABEL_BUILD_ID

COPY [".", "/etc/roaster/scripts"]

RUN --mount=type=cache,id=ccache,target=/root/.ccache /etc/roaster/scripts/setup.sh lz4
RUN --mount=type=cache,id=ccache,target=/root/.ccache /etc/roaster/scripts/setup.sh zstd
RUN --mount=type=cache,id=ccache,target=/root/.ccache /etc/roaster/scripts/setup.sh cmake
RUN --mount=type=cache,id=ccache,target=/root/.ccache /etc/roaster/scripts/setup.sh hiredis
RUN --mount=type=cache,id=ccache,target=/root/.ccache /etc/roaster/scripts/setup.sh ccache
RUN --mount=type=cache,id=ccache,target=/root/.ccache /etc/roaster/scripts/setup.sh c-ares
RUN --mount=type=cache,id=ccache,target=/root/.ccache /etc/roaster/scripts/setup.sh axel
RUN --mount=type=cache,id=ccache,target=/root/.ccache /etc/roaster/scripts/setup.sh ipt
RUN --mount=type=cache,id=ccache,target=/root/.ccache /etc/roaster/scripts/setup.sh ucx
RUN --mount=type=cache,id=ccache,target=/root/.ccache /etc/roaster/scripts/setup.sh ompi
