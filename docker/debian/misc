# syntax=docker/dockerfile:1

FROM docker.codingcafe.org/xkszltl/roaster/ubuntu:stage-util

ARG LABEL_BUILD_ID=Undefined
LABEL BUILD_ID=$LABEL_BUILD_ID

COPY [".", "/etc/roaster/scripts"]

RUN --mount=type=cache,id=ccache,target=/root/.ccache /etc/roaster/scripts/setup.sh catch2
RUN --mount=type=cache,id=ccache,target=/root/.ccache /etc/roaster/scripts/setup.sh jsoncpp
RUN --mount=type=cache,id=ccache,target=/root/.ccache /etc/roaster/scripts/setup.sh rapidjson
RUN --mount=type=cache,id=ccache,target=/root/.ccache /etc/roaster/scripts/setup.sh simdjson
RUN --mount=type=cache,id=ccache,target=/root/.ccache /etc/roaster/scripts/setup.sh utf8proc
RUN --mount=type=cache,id=ccache,target=/root/.ccache /etc/roaster/scripts/setup.sh pugixml
RUN --mount=type=cache,id=ccache,target=/root/.ccache /etc/roaster/scripts/setup.sh pybind
RUN --mount=type=cache,id=ccache,target=/root/.ccache /etc/roaster/scripts/setup.sh grpc
RUN --mount=type=cache,id=ccache,target=/root/.ccache /etc/roaster/scripts/setup.sh libpng
RUN --mount=type=cache,id=ccache,target=/root/.ccache /etc/roaster/scripts/setup.sh mkl-dnn
RUN --mount=type=cache,id=ccache,target=/root/.ccache /etc/roaster/scripts/setup.sh opencv
RUN --mount=type=cache,id=ccache,target=/root/.ccache /etc/roaster/scripts/setup.sh leveldb
RUN --mount=type=cache,id=ccache,target=/root/.ccache /etc/roaster/scripts/setup.sh rocksdb
RUN --mount=type=cache,id=ccache,target=/root/.ccache /etc/roaster/scripts/setup.sh lmdb
