# syntax=docker/dockerfile:1

FROM docker.codingcafe.org/sandbox/centos:stage-llvm

ARG LABEL_BUILD_ID=Undefined
LABEL BUILD_ID=$LABEL_BUILD_ID

COPY [".", "/etc/roaster/scripts"]

RUN --mount=type=cache,id=ccache,target=/root/.ccache /etc/roaster/scripts/setup.sh boost
RUN --mount=type=cache,id=ccache,target=/root/.ccache /etc/roaster/scripts/setup.sh jemalloc
RUN --mount=type=cache,id=ccache,target=/root/.ccache /etc/roaster/scripts/setup.sh eigen
RUN --mount=type=cache,id=ccache,target=/root/.ccache /etc/roaster/scripts/setup.sh openblas
RUN --mount=type=cache,id=ccache,target=/root/.ccache /etc/roaster/scripts/setup.sh gtest
RUN --mount=type=cache,id=ccache,target=/root/.ccache /etc/roaster/scripts/setup.sh benchmark
RUN --mount=type=cache,id=ccache,target=/root/.ccache /etc/roaster/scripts/setup.sh gflags
RUN --mount=type=cache,id=ccache,target=/root/.ccache /etc/roaster/scripts/setup.sh glog
RUN --mount=type=cache,id=ccache,target=/root/.ccache /etc/roaster/scripts/setup.sh snappy
RUN --mount=type=cache,id=ccache,target=/root/.ccache /etc/roaster/scripts/setup.sh protobuf
RUN --mount=type=cache,id=ccache,target=/root/.ccache /etc/roaster/scripts/setup.sh nsync
